# Genome comparisons

Here, we compiled a dataset of 242 *Wolbachia* genomes that included *w*Bic plus previously compiled 199 genomes and 42 additional genomes from Genbank. This genome set is in <wolb242.fa>, and was used for comparative analyses. In the analyses, [Prokka](https://github.com/tseemann/prokka) used to predict the CDS regions across genomes, which was then used to analyse the shared orthoroups using OrthoFinder. Orthogroups that are single-copy in at least 95% of genomes in our dataset were used for sequence alignment using [mafft](https://mafft.cbrc.jp/alignment/server/index.html), alignment correction using [trimAl](https://github.com/inab/trimal), concatenation using [phyutility](https://github.com/blackrim/phyutility), and phylogenetic analysis using [iqtree](https://github.com/iqtree/iqtree2).
```bash
# CDS region prediction with PROKKA
mkdir wolb242_proteome wolb242_output wolb242_gene
for i in `ls wolb242`; do prokka --outdir ./prokka_wolb242/$i --prefix $i --locustag $i --prefix $i --genus wolbachia --kingdom Bacteria --noanno --cpus 20 wolb242/$i; done
for i in `ls wolb242`; do cp prokka_wolb242/$i/$i.faa wolb242_proteome; done

# Orthogroup analysis using Orthofinder 
orthofinder -t 20 -o ~/OrthoFinder/run/Orthofinder_results_og -f ./wolb242_proteome/  -og
Orthogroups.GeneCount.tsv:: =COUNTIF(B2:GS2,"1") & =MAX(B2:GS2) > 95.orthogroups.txt

# Finding duplicates and removing them
for i in `ls 95_orthogroups_edited/`; do cat 95_orthogroups_edited/$i | grep ">" | sort | uniq -c | grep -v "1 " | sed 's/.*>//g' > temp/$i.dup.txt; seqkit grep -v -f temp/$i.dup.txt 95_orthogroups_edited/$i > 95_orthogroups_final/$i; done
for i in `ls 95_orthogroups_final/*`; do cat $i | grep ">" | sort | uniq -c | grep "1 " | wc ; done

# Phylogenetic analyses
for i in `ls ./95_orthogroups_final`; do mafft --auto --thread 16 ./95_orthogroups_final/$i > ./mafft/$i.aln; done
for i in `ls ./mafft`; do trimal -automated1 -in ./mafft/$i -out ./trimal/$i; done 
./phyutility -concat -aa -in ./trimal/* -out ./OG613_supermatrix.nexus
iqtree2 -s ~/Wolbachia/Orthology/OG613_supermatrix.nexus -T 72 -m LG+G4 -B 1000 --prefix ~/output/iqtree_B1000/result/OG613
```
Out of 242 *Wolbachia* genomes in our dataset, 126 were complete or circular in nature. This subset of 126 genomes were used to compare genome-wide GC percentage among them.
```bash
seqkit fx2tab --infile-list ../circular_genomes -n -g -G -l -i > cir_genomes.gc
seqkit stats --infile-list ../circular_genomes  > cir_genomes.stats
```
Two closely related genomes of *w*Bic - *w*Tae and *w*Con - were compared together using the online tools like [OrthoVenn](https://orthovenn3.bioinfotoolkits.net/), [GGDC](ggdc.dsmz.de), and [D-GENIES](https://dgenies.toulouse.inra.fr/). Further comparisons and visulization were conducted using [dnaapler](https://github.com/gbouras13/dnaapler), [fastANI](https://github.com/ParBLiSS/FastANI) and [pyGenomeViz](https://github.com/moshi4/pyGenomeViz).
```bash
# Genome reorientation
conda activate dnaapler
dnaapler chromosome -i data/wBic.fasta -o wbic -p wBic -t 8
dnaapler chromosome -i data/wTae.fasta -o wtae -p wTae -t 8
dnaapler chromosome -i data/wCon.fasta -o wcon -p wCon -t 8
cp wbic/wBic_reoriented.fasta wtae/wTae_reoriented.fasta wcon/wCon_reoriented.fasta ./dnaapler

# FastANI analyses
mkdir out
./fastANI -q dnaapler/wTae_reoriented.fasta -r dnaapler/wBic_reoriented.fasta --visualize -o out/ani_taebic_reor.out
./fastANI -q dnaapler/wCon_reoriented.fasta -r dnaapler/wBic_reoriented.fasta --visualize -o out/ani_conbic_reor.out
./fastANI -q dnaapler/wTae_reoriented.fasta -r dnaapler/wCon_reoriented.fasta --visualize -o out/ani_taecon_reor.out
cat out/ani_taebic_reor.out >> out/summary.txt
cat out/ani_conbic_reor.out >> out/summary.txt
cat out/ani_taecon_reor.out >> out/summary.txt

#pygenome plot
conda activate pygenomeviz
python scripts/visualize.py dnaapler/wTae_reoriented.fasta dnaapler/wBic_reoriented.fasta out/ani_taebic_reor.out.visual out/taebic.png --cmap viridis --link_color red --curve
python scripts/visualize.py dnaapler/wCon_reoriented.fasta dnaapler/wBic_reoriented.fasta out/ani_conbic_reor.out.visual out/conbic.png --cmap viridis --link_color red --curve
python scripts/visualize.py dnaapler/wTae_reoriented.fasta dnaapler/wCon_reoriented.fasta out/ani_taecon_reor.out.visual out/taecon.png --cmap viridis --link_color red --curve
```
