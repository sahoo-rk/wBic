# Structural analyses

First, we predicted protein structure models from amino acid sequences using [ColabFold](https://github.com/sokrypton/ColabFold), which is based on MMseqs2 and AlphaFold2. Resulting protein models visualized using [PAE Viewer](https://pae-viewer.uni-goettingen.de/), [ChimeraX](https://www.rbvi.ucsf.edu/chimerax/), or [open-source PyMol](https://github.com/schrodinger/pymol-open-source). Associated statistics are generated by defaults from the analyses. Additionally, these outputs can be manually retieved from the result files. For instance,

```
# retrieving plddt score for all proteins (rank_1 only)
jq -r '.plddt[]' myfile.json
jq -r '.plddt | to_entries[] | "\(.key + 1)\t\(.value)"' myfile.json
for file in *.json; do
  name="${file%.json}"  # Remove .json extension
  jq -r --arg file "$name" '.plddt | to_entries[] | "\(.key + 1)\t\(.value)\t\($file)"' "$file" >> wmelH_plddt.out
done
>> PLDDT distribution plot in R

# retrieving all rank plddt scores for all proteins (all ranks)
for i in {1..5}; do
  for file in *rank_00$i*.json; do
    [ -e "$file" ] || continue  # Skip if no file matches
    name="${file%.json}"  # Remove .json extension
    jq -r --arg file "$name" '.plddt | to_entries[] | "\(.key + 1)\t\(.value)\t\($file)"' "$file" >> output.out
  done
done
# see R-script for further data management and analyses

```

Next, for molecular dynamics simulation of the predicted protein models, we used [GROMACS](https://www.gromacs.org/) and followed the standard instructions described in [this](http://www.mdtutorials.com/gmx/lysozyme/index.html) tutorial.  We employed tools such as [VMD](https://www.ks.uiuc.edu/Research/vmd/), [QtGrace](sourceforge.net/projects/qtgrace/), [open-source PyMol](https://github.com/schrodinger/pymol-open-source), and [TM-align](https://zhanggroup.org/TM-align/) to analyze the simulation outputs.

```
 Molecular dynamics simulation using Gromacs
grep -v HOH wmel.pdb > wmel_clean.pdb       # remove any crystal water in the file
gmx pdb2gmx -f wmel_clean.pdb -o wmel_processed.gro -water spce -ignh     [15]    #generates gmx topology files maintaining all force fields
gmx editconf -f wmel_processed.gro -o wmel_newbox.gro -c -d 1.0 -bt cubic         #defining system/box dimensions
gmx solvate -cp wmel_newbox.gro -cs spc216.gro -o wmel_solv.gro -p topol.top      #filling box with water solvent
gmx grompp -f ions.mdp -c wmel_solv.gro -p topol.top -o ions.tpr
gmx genion -s ions.tpr -o wmel_solv_ions.gro -p topol.top -pname NA -nname CL -neutral    [13]    #ion neutralization
gmx grompp -f minim.mdp -c wmel_solv_ions.gro -p topol.top -o em.tpr                              #energy minimization

gmx mdrun -v -deffnm em -ntomp 8 -ntmpi 1
gmx grompp -f nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr
gmx mdrun -deffnm nvt -bonded gpu -nb gpu -pme gpu -pmefft gpu -update gpu -ntomp 8 -ntmpi 1
gmx grompp -f npt.mdp -c nvt.gro -r nvt.gro -t nvt.cpt -p topol.top -o npt.tpr
gmx mdrun -deffnm npt -bonded gpu -nb gpu -pme gpu -pmefft gpu -update gpu -ntomp 8 -ntmpi 1
gmx grompp -f md.mdp -c npt.gro -t npt.cpt -p topol.top -o md_0_100.tpr
gmx mdrun -deffnm md_0_100 -bonded gpu -nb gpu -pme gpu -pmefft gpu -update gpu -ntomp 8 -ntmpi 1

gmx trjconv -s md_0_100.tpr -f md_0_100.xtc -o md_0_100_noPBC.xtc -pbc mol -center  [1,0]
gmx rms -s md_0_100.tpr -f md_0_100_noPBC.xtc -o wmel_rmsd.xvg -tu ns       [4,4]
gmx rmsf -s md_0_100.tpr -f md_0_100_noPBC.xtc -o wmel_rmsf.xvg -res    [4]
gmx gyrate -s md_0_100.tpr -f md_0_100_noPBC.xtc -o wmel_gyrate.xvg     [1]
gmx trjconv -dt 10 -tu ns -o wbic_8f.pdb -f md_0_100_noPBC.xtc -s md_0_100.gro -b 25 -e 95   [1]
gmx cluster -f md_0_100_noPBC.xtc -s md_0_100.gro -sz cluster-size.xvg -cl cluster-central.pdb -tu ns -b 20 -e 100

gmx make_ndx -f md_0_100.tpr -o wbic_D1.ndx [r 19-75, q]
gmx make_ndx -f md_0_100.tpr -o wbic_D2.ndx [r 135-192, q]
gmx rms -s md_0_100.tpr -f md_0_100_noPBC.xtc -o wbic_D1_rmsd.xvg -tu ns -n wbic_D1.ndx     [17,17]
gmx rms -s md_0_100.tpr -f md_0_100_noPBC.xtc -o wbic_D2_rmsd.xvg -tu ns -n wbic_D2.ndx     [17,17]
gmx rmsf -s md_0_100.tpr -f md_0_100_noPBC.xtc -o wbic_50ns_rmsf.xvg -b 50000 -res -fit [4]
gmx trjconv -dt 10 -tu ns -o wbic_50ns.pdb -f md_0_100_noPBC.xtc -s md_0_100.gro -b 50   [1]
gmx sasa -s md_0_100.tpr -f md_0_100_noPBC.xtc -or wbic_resarea.xvg
```

Third, conformations from the molecular dynamics trajectory were compared through CCA and PCA analyses, using the R package [Bio3d](http://thegrantlab.org/bio3d/index.html), to understand conformational dynamics within and between protein homologs. Below mentioned the codes used for analyzing wBic-Wmk only.

```
library(bio3d)
dcd <- read.dcd("~/gromacs-wbic/wbic_20-1000.dcd")   #VMD: .xtc, .gro; protein only; .dcd
pdb <- read.pdb("~/gromacs-wbic/WKH12_7.pdb")
ca.inds <- atom.select(pdb, elety="CA")
xyz <- fit.xyz(fixed=pdb$xyz, mobile=dcd, fixed.inds=ca.inds$xyz, mobile.inds=ca.inds$xyz)
dim(xyz) == dim(dcd)

#PCA analysis
pc <- pca.xyz(xyz[,ca.inds$xyz])
print(pc)
plot(pc, col=bwr.colors(nrow(xyz)))
plot(pc, pch=16, col="grey", cex=0.8)

#cross correlation analysis
cij<-dccm(xyz[,ca.inds$xyz])
plot(cij)
pymol.dccm(cij, pdb, type="launch")
pymol.dccm(cij, pdb, type="script") #rename the file cca.py and open it in pymol
```


